import Foundation


// JSON DATA
/* url: https://api.coingecko.com/api/v3/global

 JSON Response
 
 {
   "data": {
     "active_cryptocurrencies": 10762,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 715,
     "total_market_cap": {
       "btc": 43784517.145645656,
       "eth": 647662791.2729917,
       "ltc": 13902578076.19747,
       "bch": 10065447139.026085,
       "bnb": 3890258855.6121798,
       "eos": 1141587877088.7754,
       "xrp": 2558640623416.903,
       "xlm": 12918213596944.365,
       "link": 161831747686.98056,
       "dot": 197203978866.4506,
       "yfi": 150100808.80215535,
       "usd": 1265550905002.9902,
       "aed": 4647735698623.5,
       "ars": 275174301698782.3,
       "aud": 1884964671049.4653,
       "bdt": 134089485801240.17,
       "bhd": 477067131353.5456,
       "bmd": 1265550905002.9902,
       "brl": 6424316059066.676,
       "cad": 1704804640865.9546,
       "chf": 1133731122737.8787,
       "clp": 1004405480603043.9,
       "cny": 8710027548592.589,
       "czk": 27076208502357.99,
       "dkk": 8598507202843.705,
       "eur": 1153777449073.1282,
       "gbp": 1017458633340.7288,
       "hkd": 9933751996185.217,
       "huf": 437211455621116.56,
       "idr": 18929200480623028,
       "ils": 4627651405761.093,
       "inr": 103990710184876.4,
       "jpy": 170330875969624.06,
       "krw": 1675119556122724.8,
       "kwd": 387815419329.1168,
       "lkr": 405434475978359.1,
       "mmk": 2652159839674252.5,
       "mxn": 22873310150190.35,
       "myr": 5615882140950.785,
       "ngn": 581579662346430.6,
       "nok": 13426963570701.64,
       "nzd": 2052815953130.916,
       "php": 70934763531971.8,
       "pkr": 354258131012949.9,
       "pln": 5321882010209.538,
       "rub": 103408170775549.17,
       "sar": 4746184169074.578,
       "sek": 13098840390908.8,
       "sgd": 1687747545768.3247,
       "thb": 43522295623052.87,
       "try": 24563052204184.957,
       "twd": 38674605412540.72,
       "uah": 46643988277243.7,
       "vef": 126719612117.94948,
       "vnd": 29725215786388140,
       "zar": 23027811135774.938,
       "xdr": 936092569005.3726,
       "xag": 50247192677.56677,
       "xau": 633446194.481149,
       "bits": 43784517145645.66,
       "sats": 4378451714564565.5
     },
     "total_volume": {
       "btc": 2477075.8879602607,
       "eth": 36641031.77054025,
       "ltc": 786527822.5743438,
       "bch": 569445046.6744422,
       "bnb": 220088447.6379146,
       "eos": 64584469320.92227,
       "xrp": 144753154936.91415,
       "xlm": 730838147879.2578,
       "link": 9155508527.556173,
       "dot": 11156665709.821344,
       "yfi": 8491839.547078999,
       "usd": 71597583715.29637,
       "aed": 262942126194.42694,
       "ars": 15567777656585.242,
       "aud": 106640448284.07852,
       "bdt": 7586011077897.062,
       "bhd": 26989711547.652885,
       "bmd": 71597583715.29637,
       "brl": 363450814213.95874,
       "cad": 96448031059.12009,
       "chf": 64139979395.511086,
       "clp": 56823479164126.54,
       "cny": 492763210162.1561,
       "czk": 1531815984072.0232,
       "dkk": 486454031085.1631,
       "eur": 65274085121.5615,
       "gbp": 57561951391.66822,
       "hkd": 561994493735.6613,
       "huf": 24734906886298.27,
       "idr": 1070905177118760.9,
       "ils": 261805872540.86462,
       "inr": 5883195649136.862,
       "jpy": 9636340271516.857,
       "krw": 94768619878110.31,
       "kwd": 21940363553.715443,
       "lkr": 22937148336091.062,
       "mmk": 150043933749923.4,
       "mxn": 1294040193760.7734,
       "myr": 317714277736.6285,
       "ngn": 32902428813690.41,
       "nok": 759620292234.1348,
       "nzd": 116136507409.82195,
       "php": 4013080509229.3794,
       "pkr": 20041885389007.07,
       "pln": 301081443063.72784,
       "rub": 5850238923364.802,
       "sar": 268511773829.223,
       "sek": 741056971911.5188,
       "sgd": 95483038825.80534,
       "thb": 2462240903969.0435,
       "try": 1389636070378.514,
       "twd": 2187986502742.768,
       "uah": 2638848300999.2925,
       "vef": 7169066057.412628,
       "vnd": 1681681564374643,
       "zar": 1302780969975.9048,
       "xdr": 52958727941.86073,
       "xag": 2842696860.2912207,
       "xau": 35836738.57701741,
       "bits": 2477075887960.2607,
       "sats": 247707588796026.06
     },
     "market_cap_percentage": {
       "btc": 44.19702959296992,
       "eth": 18.583374921370734,
       "usdt": 6.436705496599063,
       "bnb": 4.05826458611821,
       "usdc": 2.4721554501046388,
       "xrp": 2.0208303919827215,
       "ada": 1.157802828624309,
       "doge": 1.0104017279310025,
       "steth": 0.9340703984672463,
       "matic": 0.7943041592228167
     },
     "market_cap_change_percentage_24h_usd": -4.0427269107171,
     "updated_at": 1681978693
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { (key: String, value: Double) in
            return key == "usd"
        }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentage()
        }
        return ""
    }
}
